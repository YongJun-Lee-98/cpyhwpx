[개발 기획서] HWP Automation C++/MFC Porting1. 개요 및 목표목표: Python 기반의 pyhwpx 모듈이 제공하는 고수준(High-level) HWP 제어 기능을 C++/MFC 환경으로 이식(Porting)하여, 네이티브 윈도우 애플리케이션에서 안정적인 HWP 문서 자동화를 구현함.핵심 과제: 복잡한 COM 인터페이스(HAction, HParameterSet 등)를 캡슐화하여, pyhwpx처럼 직관적인 래퍼(Wrapper) 클래스 라이브러리를 구축.2. 개발 환경 및 사전 준비 (Prerequisites)개발 시작 전 필수적으로 갖춰야 할 환경 요소입니다.항목상세 내용비고IDEVisual Studio (2019 이상 권장)MFC 워크로드 설치 필수TargetHWP 2010 ~ 2022 이상설치된 한글 버전에 종속됨Architecturex86 (32bit) 권장HWP가 32bit인 경우 필수 (대부분 해당)LibrariesHWP Type Libraries (.tlb)C:\Program Files (x86)\Hnc\Office\...\Bin 확인SecurityFilePathCheckerModule (DLL)필수: 보안 팝업 제거용 모듈 확보3. 아키텍처 설계 (Architecture)3.1 COM 통신 방식 선정방식: MFC COleDispatchDriver (Class Wizard 활용)선정 이유: 순수 Win32 API 대비 코드가 간결하며, 타입 라이브러리(TLB)를 통해 래퍼 클래스(CXHwpObject 등)를 자동 생성해주므로 생산성이 높음.3.2 클래스 구조 설계 (Class Hierarchy)pyhwpx의 구조를 본따 아래와 같은 C++ 클래스 구조를 제안합니다.CHwpWrapper (Main Facade Class)모든 HWP 제어의 진입점.내부에 COleDispatchDriver 인스턴스 관리.초기화(Initialize), 종료(Quit), 액션 실행(Run) 통합 관리.CHwpAction (Helper Class)HAction 인터페이스 래핑.명령어 실행(Execute) 담당.CHwpParameter (Helper Class)HParameterSet 인터페이스 래핑.액션 수행에 필요한 파라미터(텍스트 내용, 표 크기 등) 설정 담당.4. 핵심 구현 기능 명세 (Functional Requirements)pyhwpx의 주요 메서드를 C++로 매핑하여 구현해야 할 기능 리스트입니다.4.1 기본 제어 (Life Cycle)[ ] Initialize: OLE 초기화, HWP 프로세스 생성 (CreateDispatch).[ ] RegisterModule: 보안 승인 DLL 등록 (필수 선행).[ ] SetVisible: 한글 창 숨기기/보이기 제어.[ ] Quit: 리소스 해제 및 프로세스 종료.4.2 파일 조작 (File I/O)[ ] Open: 파일 경로를 받아 문서 열기 (Format: "HWP", "DOCX" 등 지정).[ ] SaveAs: 현재 문서 다른 이름으로 저장.[ ] Clear: 새 문서 상태로 초기화.4.3 문서 편집 (Editing)[ ] InsertText: 현재 커서 위치에 텍스트 삽입.[ ] MovePos: 커서 이동 (문서 시작, 끝, 줄 단위 이동).[ ] GetText: 지정된 범위 또는 필드의 텍스트 추출.[ ] CreateTable: 행/열 개수를 지정하여 표 생성.4.4 고급 기능 (Automation Pattern)[ ] Run (Action 실행): HAction.Execute를 래핑하여 액션 ID(예: "FileSave")만으로 동작하게 구현.[ ] ParamSet 설정: 액션 실행 전 필요한 파라미터를 세팅하는 로직 캡슐화.5. 단계별 구현 계획 (Roadmap)Phase 1: 환경 구축 및 기본 연동MFC 프로젝트 생성 및 AfxOleInit() 초기화.Visual Studio Class Wizard를 사용해 HwpObject.tlb 로드 및 MFC 클래스 자동 생성 (CXHwpObject, CXHwpWindows 등).CreateDispatch("HWPFrame.HwpObject")로 한글 실행 테스트.Phase 2: 보안 모듈 및 래퍼 클래스 기초가장 중요: RegisterModule 구현하여 파일 열기/저장 시 팝업 차단.CHwpWrapper 클래스 생성 및 Initialize, Open, Quit 메서드 구현.Phase 3: 액션 및 파라미터 로직 구현 (Core)pyhwpx의 HParameterSet 패턴을 분석하여 C++ InvokeHelper로 변환.Python: pset.Text = "..."C++: pSet.SetProperty(DISPID_Text, ...)InsertText, CreateTable 등 파라미터가 필요한 메서드 구현.Phase 4: 안정화 및 예외 처리COM 객체 해제(ReleaseDispatch) 누락 점검 (메모리 릭 방지).한글이 설치되지 않은 환경이나, 이미 실행 중인 경우에 대한 예외 처리.6. 주요 고려사항 및 리스크 (Checklist)이 프로젝트 진행 시 발생할 수 있는 주요 이슈와 해결 방안입니다.6.1 아키텍처 불일치 (Bitness)Risk: 한글 프로그램은 대부분 32-bit입니다. 개발하는 MFC 애플리케이션을 64-bit(x64)로 빌드하면 COM 통신이 실패하거나 불안정할 수 있습니다.Action: 프로젝트 설정을 x86 (Win32) 로 고정하십시오.6.2 보안 승인 (Security Module)Risk: 이 부분을 구현하지 않으면 스크립트 실행 시마다 "접근을 허용하시겠습니까?"라는 팝업이 뜨며 자동화가 불가능해집니다.Action: 한컴 개발자 포럼에서 제공하는 FilePathCheckerModule 예제 DLL을 확보하고, 초기화 단계에서 반드시 등록해야 합니다.6.3 COM 메모리 관리Risk: Python은 GC가 자동으로 처리하지만, C++은 수동입니다.Action: COleDispatchDriver 멤버 변수는 소멸자에서 ReleaseDispatch()를, OLE 라이브러리는 OleUninitialize()를 호출하여 명시적으로 정리해야 합니다.6.4 스레딩 모델 (STA)Risk: COM은 기본적으로 STA(Single Threaded Apartment) 모델입니다. 멀티 스레드에서 하나의 HWP 인스턴스에 접근하면 충돌이 발생합니다.Action: HWP 제어는 메인 UI 스레드에서만 수행하거나, 별도 스레드 사용 시 마샬링(Marshaling) 처리가 필요하므로 주의가 필요합니다.